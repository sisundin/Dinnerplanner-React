{"ast":null,"code":"import apiConfig from './apiConfig.js';\nimport React from \"react\";\n\nclass DinnerModel extends React.Component {\n  constructor(guests = 2, dishes = []) {\n    super();\n    this.numberOfGuests = guests;\n    this.subscribers = [];\n    this.dishes = dishes;\n  }\n\n  setNumberOfGuests(x) {\n    this.numberOfGuests = x;\n    this.notifyObservers(); // TODO\n  }\n\n  getNumberOfGuests() {\n    return this.numberOfGuests; // TODO\n  }\n\n  addObserver(callback) {\n    this.subscribers.push(callback);\n  }\n\n  removeObserver(callback) {\n    callback = this.subscribers.filter(o => o !== callback);\n  }\n\n  notifyObservers(whatHappened) {\n    this.subscribers.forEach(function (callback) {\n      callback(whatHappened);\n    });\n  }\n\n  dishInMenu(dish) {\n    let array = this.dishes.filter(function (di) {\n      return di.id === dish.id;\n    });\n\n    if (array.length < 1 || array === undefined) {\n      return true;\n    }\n\n    return false;\n  }\n\n  getDishPrice(dish) {\n    this.dishprice = this.sum(dish.extendedIngredients) * this.getNumberOfGuests();\n    return this.dishprice;\n  }\n\n  sum(input) {\n    if (toString.call(input) !== \"[object Array]\") return false;\n    var total = 0;\n\n    for (var i = 0; i < input.length; i++) {\n      if (isNaN(input[i].amount)) {\n        continue;\n      }\n\n      total += Number(input[i].amount);\n    }\n\n    return total;\n  }\n\n  addToMenu(dish) {\n    const uniqify = (array, key) => array.reduce((prev, curr) => prev.find(a => a[key] === curr[key]) ? prev : prev.push(curr) && prev, []);\n\n    this.dishes = [...this.dishes, dish];\n    this.dishes = uniqify(this.dishes, 'id');\n    this.notifyObservers({\n      add_dish: dish\n    });\n  }\n\n  getApiData(string) {\n    return fetch(apiConfig.ENDPOINT + string, {\n      \"method\": \"GET\",\n      \"headers\": {\n        'X-Mashape-Key': apiConfig.API_KEY\n      }\n    }).then(this.handleHTTPError()).then(response => response.json()).catch(console.error);\n  }\n\n  searchDishes(dishType = \"\", freeText = \"\") {\n    return this.getApiData(\"recipes/search?type=\" + dishType + \"&query=\" + freeText).then(data => data.results); // from headers to response data   \n  }\n\n  handleHTTPError(response) {\n    if (response.ok) return response;\n    throw Error(response.statusText);\n  }\n\n  getDishDetails(id) {\n    return this.getApiData(\"recipes/\" + id + \"/information\");\n  }\n\n  getMenu() {\n    return [...this.dishes];\n  }\n\n  removeFromMenu(dishid) {\n    this.dishes = this.dishes.filter(dish => dish.id !== dishid);\n    this.notifyObservers({\n      removed: dishid\n    });\n  }\n\n  getShoppingList() {\n    this.shoppingListObj = [];\n    this.getMenu().forEach(dish => dish.extendedIngredients.forEach(ingredient => {\n      if (this.shoppingListObj.find(listobject => listobject.name === ingredient.name)) {\n        this.shoppingListObj.forEach(dubble => {\n          if (dubble.name === ingredient.name) {\n            dubble.amount += ingredient.amount;\n          }\n        });\n      } else {\n        this.shoppingListObj.push({\n          name: ingredient.name,\n          aisle: ingredient.aisle,\n          amount: ingredient.amount\n        });\n      }\n    }));\n    let x = this.shoppingListObj.sort(function (a, b) {\n      if (a.aisle < b.aisle) {\n        return -1;\n      }\n\n      if (a.aisle > b.aisle) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n    x = x.sort(function (a, b) {\n      if (a.aisle === b.aisle && a.name < b.name) {\n        return -1;\n      }\n\n      if (a.aisle === b.aisle && a.name < b.name) {\n        return 1;\n      } else {\n        return 0;\n      }\n    });\n    return x;\n  }\n\n}\n\nconst dinnerModel = new DinnerModel();\nexport default dinnerModel;","map":{"version":3,"sources":["/Users/simonsundin/Desktop/KTH/Interaktions_design/tutorialweek4/dinnerplanner/src/dinnerstuff/DinnerModel.js"],"names":["apiConfig","React","DinnerModel","Component","constructor","guests","dishes","numberOfGuests","subscribers","setNumberOfGuests","x","notifyObservers","getNumberOfGuests","addObserver","callback","push","removeObserver","filter","o","whatHappened","forEach","dishInMenu","dish","array","di","id","length","undefined","getDishPrice","dishprice","sum","extendedIngredients","input","toString","call","total","i","isNaN","amount","Number","addToMenu","uniqify","key","reduce","prev","curr","find","a","add_dish","getApiData","string","fetch","ENDPOINT","API_KEY","then","handleHTTPError","response","json","catch","console","error","searchDishes","dishType","freeText","data","results","ok","Error","statusText","getDishDetails","getMenu","removeFromMenu","dishid","removed","getShoppingList","shoppingListObj","ingredient","listobject","name","dubble","aisle","sort","b","dinnerModel"],"mappings":"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","sourcesContent":["import apiConfig from './apiConfig.js';\nimport React  from \"react\";\n\nclass DinnerModel extends React.Component{\n    constructor(guests=2, dishes=[]){\n        super();\n        this.numberOfGuests=guests;\n        this.subscribers=[];\n        this.dishes=dishes;\n        }\n        \n    \n    setNumberOfGuests(x){\n        this.numberOfGuests=x; \n        this.notifyObservers() // TODO\n\n    }\n    getNumberOfGuests(){\n        return this.numberOfGuests; // TODO\n    }\n\n    \n    addObserver(callback){\n        this.subscribers.push(callback);\n }\n\n    removeObserver (callback) {\n    callback = this.subscribers.filter(o => o !== callback);\n    };\n   \n    notifyObservers(whatHappened){\n        this.subscribers.forEach(function(callback){ \n            callback(whatHappened);\n       });\n    }\n     \n    dishInMenu(dish){\n        let array = this.dishes.filter(function(di){ return di.id === dish.id });\n        if(array.length < 1 || array === undefined){\n            return true;\n        }\n        return false;\n    }  \n\n    getDishPrice(dish){\n        this.dishprice = this.sum(dish.extendedIngredients) * this.getNumberOfGuests();\n        return this.dishprice;\n    }\n\n    sum(input){\n             \n        if (toString.call(input) !== \"[object Array]\")\n           return false;\n             \n                   var total =  0;\n                   for(var i=0;i<input.length;i++)\n                     {                  \n                       if(isNaN(input[i].amount)){\n                       continue;\n                        }\n                         total += Number(input[i].amount);\n                      }\n                    return total;\n                   }\n  \n\n    addToMenu(dish){\n        const uniqify = (array, key) => array.reduce((prev, curr) => \n        prev.find(a => a[key] === curr[key]) ? prev : prev.push(curr) && prev, []);\n        this.dishes=[...this.dishes, dish];\n        this.dishes = uniqify(this.dishes, 'id')\n        this.notifyObservers({\n            add_dish: dish\n        })\n    }\n    \n\n    getApiData(string) {\n            \n        return fetch (apiConfig.ENDPOINT+string, {\n            \"method\": \"GET\",\n            \"headers\": {\n            'X-Mashape-Key' : apiConfig.API_KEY\n        } ,               \n\n    }) \n\n        .then(this.handleHTTPError())\n        .then(response => response.json())\n        .catch(console.error);\n         \n    }\n    \n\n    searchDishes(dishType=\"\", freeText=\"\") {\n        return this.getApiData(\"recipes/search?type=\"+dishType+\"&query=\"+freeText)\n        .then(data=>data.results)   // from headers to response data   \n        \n    }\n    handleHTTPError(response) {\n        if(response.ok)\n           return response;\n        throw Error(response.statusText);\n      }\n\n    getDishDetails(id){\n        return this.getApiData(\"recipes/\"+id+\"/information\")\n    }\n\n    getMenu(){\n        return [...this.dishes]\n    }\n\n    removeFromMenu(dishid){\n        this.dishes = this.dishes.filter(dish => dish.id !== dishid);\n        this.notifyObservers({removed:dishid});\n\n    \n    }\n\n    getShoppingList(){\n        this.shoppingListObj= []\n        this.getMenu().forEach(dish => \n        dish.extendedIngredients.forEach(ingredient => {\n        if (this.shoppingListObj.find(listobject => listobject.name === ingredient.name)){\n            this.shoppingListObj.forEach( dubble => {                   \n                 if (dubble.name === ingredient.name) {\n                        dubble.amount += ingredient.amount;\n                    }\n            })\n                \n            }\n        else {\n            this.shoppingListObj.push({name: ingredient.name , aisle: ingredient.aisle , amount: ingredient.amount});\n            }\n        }));\n        let x = this.shoppingListObj.sort(function(a,b) \n        {if (a.aisle < b.aisle){return -1;}\n        if (a.aisle > b.aisle){return 1;}\n        else {return 0;}\n        });\n        x = x.sort(function(a,b) \n        {if (a.aisle === b.aisle && a.name < b.name){return -1;}\n        if (a.aisle === b.aisle && a.name < b.name) {return 1;}\n        else {return 0;} \n        });\n        return x;\n        }\n      \n        \n       \n    \n}\n\n\nconst dinnerModel = new DinnerModel();\nexport default dinnerModel;"]},"metadata":{},"sourceType":"module"}